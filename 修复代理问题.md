# 🔧 修复 Vercel 代理问题

## 🚨 问题分析

从浏览器控制台可以看到，前端仍然在直接访问：
```
http://8.148.177.179:5000/api/health
```

这说明 Vercel 代理配置没有生效。

## 🔍 可能的原因

1. **Vercel 环境变量覆盖了代码配置**
   - 如果 Vercel 中设置了 `VITE_API_BASE_URL=http://8.148.177.179:5000/api`
   - 它会覆盖代码中的相对路径配置

2. **代码还没有重新部署**
   - 修改代码后需要重新构建和部署

3. **构建缓存问题**
   - Vercel 可能使用了旧的构建缓存

## ✅ 解决方案

### 方案 1: 删除或修改 Vercel 环境变量（推荐）

1. 登录 [Vercel 控制台](https://vercel.com)
2. 进入项目 `ship-steel`
3. **Settings** → **Environment Variables**
4. 查找 `VITE_API_BASE_URL`
5. **删除这个环境变量**（让代码中的默认值生效）
6. 或者设置为相对路径：`/api/backend`
7. **保存后重新部署**

### 方案 2: 强制代码使用相对路径

如果环境变量无法删除，修改代码强制使用相对路径：

```javascript
// 生产环境强制使用相对路径，忽略环境变量
const API_BASE_URL = import.meta.env.PROD 
  ? '/api/backend'  // 生产环境强制使用代理
  : (import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000/api');
```

### 方案 3: 清除缓存并重新部署

1. 在 Vercel 项目页面
2. **Settings** → **General**
3. 找到 **"Clear Build Cache"** 或类似选项
4. 清除缓存
5. 手动触发重新部署

## 📋 立即执行的步骤

### 步骤 1: 检查 Vercel 环境变量

```bash
# 在 Vercel 控制台检查：
Settings → Environment Variables
```

如果存在 `VITE_API_BASE_URL`，**删除它**或设置为 `/api/backend`

### 步骤 2: 修改代码强制使用代理（可选）

如果环境变量必须保留，修改代码忽略它：

```javascript
// 强制生产环境使用代理
const API_BASE_URL = import.meta.env.PROD 
  ? '/api/backend'
  : (import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000/api');
```

### 步骤 3: 提交并推送代码

```bash
cd frontend
git add .
git commit -m "强制使用 Vercel 代理路径"
git push origin main
```

### 步骤 4: 在 Vercel 手动重新部署

1. 进入 Vercel 项目
2. 点击 **"Deployments"** 标签
3. 找到最新的部署
4. 点击 **"Redeploy"**
5. 或清除缓存后重新部署

## 🎯 预期结果

配置正确后，浏览器控制台应该显示：

```
🔧 API 配置信息:
  - API_BASE_URL: /api/backend
  - 当前环境: production
```

请求路径应该是：
- ✅ `/api/backend/health` (相对路径，通过代理)
- ❌ ~~`http://8.148.177.179:5000/api/health`~~ (绝对路径，被阻止)

## ⚡ 快速修复

最快的修复方法：

1. **删除 Vercel 环境变量** `VITE_API_BASE_URL`
2. **重新部署** Vercel 项目
3. **清除浏览器缓存** (Ctrl+Shift+Delete)
4. **刷新页面** (Ctrl+F5)


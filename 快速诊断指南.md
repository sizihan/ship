# 快速诊断：Vercel 前端无法连接后端

## 🚨 当前情况

- ✅ 后端正常运行: `http://你的IP:5000/` 可以访问
- ✅ 前端部署成功: `https://ship-steel.vercel.app/` 可以访问
- ❌ 前端无法连接后端

## 🔍 立即检查清单

### 步骤 1: 检查浏览器控制台

1. 打开 https://ship-steel.vercel.app/
2. 按 **F12** 打开开发者工具
3. 查看 **Console** 标签，应该看到：
   ```
   🔧 API 配置信息:
     - API_BASE_URL: http://...
     - 环境变量 VITE_API_BASE_URL: ...
     - 当前环境: production
   ```

**如果看到 "http://localhost:5000/api"**，说明环境变量未配置！

### 步骤 2: 检查 Vercel 环境变量

1. 登录 [Vercel](https://vercel.com)
2. 进入项目 `ship-steel`
3. **Settings** → **Environment Variables**
4. 检查是否有 `VITE_API_BASE_URL`
   - 如果没有：点击 "Add" 添加
   - Key: `VITE_API_BASE_URL`
   - Value: `http://你的阿里云IP:5000/api`
   - Environment: 选择 `Production`（或全部）
5. **保存后，必须重新部署！**

### 步骤 3: 检查 Network 请求

1. 在浏览器按 **F12**
2. 打开 **Network** 标签
3. 刷新页面
4. 查找对 `/health` 的请求
5. 查看请求的完整 URL

**如果看到错误类型：**

| 错误类型 | 含义 | 解决方案 |
|---------|------|---------|
| `(failed) net::ERR_FAILED` | 请求失败 | 检查后端是否运行、网络是否通 |
| `Mixed Content` | HTTPS 访问 HTTP | 使用 Nginx 代理或 HTTPS |
| `CORS` 错误 | 跨域问题 | 检查后端 CORS 配置 |
| `404` | 路径错误 | 检查 API 路径配置 |
| `Timeout` | 超时 | 检查后端响应时间 |

## 🎯 最可能的问题：混合内容

### 问题
- Vercel 是 **HTTPS** (`https://ship-steel.vercel.app/`)
- 后端是 **HTTP** (`http://IP:5000`)
- 浏览器会阻止 HTTPS 页面访问 HTTP API

### 快速解决方案

#### 方案 A: 使用 Nginx 反向代理（推荐）

1. **在阿里云服务器安装 Nginx**
```bash
sudo apt update && sudo apt install nginx -y
```

2. **配置 Nginx**
编辑文件: `/etc/nginx/sites-available/default` 或创建新配置文件

```nginx
server {
    listen 80;
    server_name _;  # 或你的域名

    location /api/ {
        proxy_pass http://127.0.0.1:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

3. **重启 Nginx**
```bash
sudo nginx -t  # 测试配置
sudo systemctl restart nginx
```

4. **更新 Vercel 环境变量**
```
VITE_API_BASE_URL=http://你的IP/api
```

#### 方案 B: 临时测试（不推荐生产）

如果只是测试，可以：
1. 使用 HTTP 访问 Vercel（不安全）
2. 或使用 CORS 代理服务

## 📋 完整检查流程

1. ✅ **后端测试**: `http://你的IP:5000/api/health` 是否返回 JSON
2. ✅ **Vercel 环境变量**: 是否配置了 `VITE_API_BASE_URL`
3. ✅ **重新部署**: 修改环境变量后是否重新部署
4. ✅ **浏览器控制台**: 查看具体错误信息
5. ✅ **Network 标签**: 查看请求状态码和响应

## 🆘 如果还是不行

请提供以下信息：

1. **浏览器控制台的完整错误信息**（截图或复制文本）
2. **Network 标签中失败的请求详情**（右键请求 → Copy → Copy as cURL）
3. **Vercel 环境变量配置**（隐藏 IP，只显示格式）
4. **后端日志**（查看后端服务器日志中的请求）

## 💡 提示

- 每次修改 Vercel 环境变量后，**必须重新部署**才会生效
- 可以在 Vercel 项目页面点击 **"Redeploy"** 重新部署
- 或者推送一次代码到 GitHub 触发自动部署


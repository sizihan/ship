# è§£å†³ HTTPS å‰ç«¯è®¿é—® HTTP åç«¯çš„é—®é¢˜

## ğŸ”´ é—®é¢˜æè¿°

ä½ çš„æƒ…å†µï¼š
- **å‰ç«¯**: HTTPS (https://ship-steel.vercel.app/)
- **åç«¯**: HTTP (http://ä½ çš„IP:5000)
- **é—®é¢˜**: æµè§ˆå™¨ä¼šé˜»æ­¢ HTTPS é¡µé¢è®¿é—® HTTP èµ„æºï¼ˆæ··åˆå†…å®¹ Mixed Contentï¼‰

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰æ¨èé¡ºåºï¼‰

### æ–¹æ¡ˆ 1: ä½¿ç”¨ Nginx åå‘ä»£ç† + HTTPSï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

è¿™æ˜¯æœ€å®‰å…¨ã€æœ€ä¸“ä¸šçš„æ–¹æ¡ˆã€‚

#### æ­¥éª¤ï¼š

1. **åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨å®‰è£… Nginx**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx

# CentOS
sudo yum install nginx
```

2. **é…ç½® Nginx åå‘ä»£ç†**
åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/ship-api` (æˆ– `/etc/nginx/conf.d/ship-api.conf`):

```nginx
server {
    listen 80;
    server_name api.yourdomain.com;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IP

    # å¦‚æœéœ€è¦ HTTPSï¼Œå–æ¶ˆä¸‹é¢çš„æ³¨é‡Š
    # listen 443 ssl;
    # ssl_certificate /path/to/your/cert.pem;
    # ssl_certificate_key /path/to/your/key.pem;

    location /api/ {
        proxy_pass http://127.0.0.1:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # CORS å¤´
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
        
        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }
}
```

3. **å¯åŠ¨ Nginx**
```bash
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl start nginx
sudo systemctl enable nginx
```

4. **é…ç½® Vercel ç¯å¢ƒå˜é‡**
åœ¨ Vercel æ§åˆ¶å°è®¾ç½®ï¼š
```
VITE_API_BASE_URL=http://ä½ çš„åŸŸåæˆ–IP/api
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Vercel Serverless Functions ä½œä¸ºä»£ç†ï¼ˆç®€å•ä½†æœ‰é™åˆ¶ï¼‰

1. **åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `api/proxy.js`**:
```javascript
export default async function handler(req, res) {
  const targetUrl = 'http://ä½ çš„é˜¿é‡Œäº‘IP:5000' + req.url.replace('/api/proxy', '');
  
  try {
    const response = await fetch(targetUrl, {
      method: req.method,
      headers: {
        'Content-Type': req.headers['content-type'] || 'application/json',
      },
      body: req.method !== 'GET' ? JSON.stringify(req.body) : undefined,
    });
    
    const data = await response.json();
    res.status(response.status).json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
```

2. **ä¿®æ”¹å‰ç«¯ API é…ç½®**:
```javascript
const API_BASE_URL = '/api/proxy/api';  // ä½¿ç”¨ç›¸å¯¹è·¯å¾„
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ç¬¬ä¸‰æ–¹ CORS ä»£ç†æœåŠ¡ï¼ˆä¸´æ—¶æµ‹è¯•ç”¨ï¼‰

ä½¿ç”¨å…è´¹çš„ CORS ä»£ç†æœåŠ¡ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰:
```
VITE_API_BASE_URL=https://cors-anywhere.herokuapp.com/http://ä½ çš„IP:5000/api
```

### æ–¹æ¡ˆ 4: åç«¯é…ç½® HTTPSï¼ˆéœ€è¦åŸŸåå’Œè¯ä¹¦ï¼‰

1. ç”³è¯· SSL è¯ä¹¦ï¼ˆLet's Encrypt å…è´¹ï¼‰
2. é…ç½® Flask ä½¿ç”¨ HTTPS
3. æ›´æ–° Vercel ç¯å¢ƒå˜é‡ä¸º HTTPS åœ°å€

## ğŸ› ï¸ å¿«é€Ÿè¯Šæ–­æ­¥éª¤

### 1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€ https://ship-steel.vercel.app/ï¼ŒæŒ‰ F12ï¼ŒæŸ¥çœ‹ï¼š

- **Console æ ‡ç­¾**: æŸ¥çœ‹ API é…ç½®å’Œé”™è¯¯ä¿¡æ¯
- **Network æ ‡ç­¾**: æŸ¥çœ‹ API è¯·æ±‚çš„è¯¦ç»†çŠ¶æ€

### 2. æµ‹è¯•åç«¯è¿æ¥

åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼š
```
http://ä½ çš„IP:5000/api/health
```

åº”è¯¥è¿”å› JSON å“åº”ã€‚

### 3. æ£€æŸ¥ Vercel ç¯å¢ƒå˜é‡

1. è¿›å…¥ Vercel é¡¹ç›®
2. Settings â†’ Environment Variables
3. ç¡®è®¤ `VITE_API_BASE_URL` å·²é…ç½®
4. å€¼ä¸º: `http://ä½ çš„IP:5000/api`

### 4. æ£€æŸ¥æ··åˆå†…å®¹é—®é¢˜

å¦‚æœçœ‹åˆ°ç±»ä¼¼é”™è¯¯ï¼š
```
Mixed Content: The page at 'https://...' was loaded over HTTPS, but requested an insecure resource 'http://...'
```

è¿™å°±æ˜¯æ··åˆå†…å®¹é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨ä¸Šè¿°è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“ æ¨èé…ç½®

å¯¹äºä½ çš„æƒ…å†µï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼š

### ä¸´æ—¶æ–¹æ¡ˆï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰:
ä½¿ç”¨ Nginx åå‘ä»£ç†ï¼Œä½†ä¸é…ç½® HTTPSï¼š
1. å®‰è£… Nginx
2. é…ç½®åå‘ä»£ç†åˆ° `http://127.0.0.1:5000`
3. Vercel ç¯å¢ƒå˜é‡è®¾ç½®ä¸º: `http://ä½ çš„IP/api`

### é•¿æœŸæ–¹æ¡ˆï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:
1. ç”³è¯·åŸŸå
2. é…ç½® Nginx + SSL è¯ä¹¦ï¼ˆLet's Encrypt å…è´¹ï¼‰
3. Vercel ç¯å¢ƒå˜é‡è®¾ç½®ä¸º: `https://api.yourdomain.com/api`

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨ç»„é…ç½®**: ç¡®ä¿é˜¿é‡Œäº‘å®‰å…¨ç»„å¼€æ”¾äº† 80 æˆ– 443 ç«¯å£
2. **é˜²ç«å¢™é…ç½®**: ç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å…è®¸ç›¸åº”ç«¯å£
3. **CORS é…ç½®**: åç«¯å·²é…ç½® CORSï¼Œå…è®¸ Vercel åŸŸå
4. **ç¯å¢ƒå˜é‡**: æ¯æ¬¡ä¿®æ”¹ Vercel ç¯å¢ƒå˜é‡åéœ€è¦é‡æ–°éƒ¨ç½²

